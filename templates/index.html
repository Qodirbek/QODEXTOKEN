<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QODEX O'yini</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script type="module" src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>
<body>
    <!-- Yuqori qism: Foydalanuvchi ma‚Äôlumotlari -->
    <header>
        <div class="stats">
            <div class="stat">
                <img src="{{ url_for('static', filename='images/coin.png') }}" alt="Tanga">
                <span id="coins">0</span>
            </div>
        </div>
        <button id="wallet-button" onclick="window.location.href='{{ url_for('wallet') }}'">
            <img src="{{ url_for('static', filename='images/wallet.png') }}" alt="Wallet">
        </button>
    </header>

    <!-- Asosiy o‚Äòyin qismi -->
    <main id="home" class="page">
        <h1>QODEX O'yiniga Xush Kelibsiz!</h1>
        <p id="message">Tuxumni bosib QODEX tanga ishlang!</p>

        <div class="egg-container">
            <img id="egg" class="egg" src="{{ url_for('static', filename='images/egg.png') }}" alt="Tuxum" onclick="clickEgg()">
        </div>

        <!-- Energiyani ko‚Äòrsatish -->
        <div class="energy-container">
            <span id="energy-text">‚ö° <span id="energy">1000</span></span>
            <div class="energy-bar">
                <div id="energy-fill"></div>
            </div>
        </div>
    </main>

    <!-- Telegram orqali kirgan-yo‚Äòqligini tekshirish -->
    <div id="warning" style="display: none; color: red; text-align: center;">
        ‚ö†Ô∏è Iltimos, bot orqali kiring!
    </div>

    <!-- Navigatsiya -->
    <footer>
        <button onclick="window.location.href='{{ url_for('index') }}'">
            <img src="{{ url_for('static', filename='images/home.png') }}" alt="Home"> Home
        </button>
        <button onclick="window.location.href='{{ url_for('earn') }}'">
            <img src="{{ url_for('static', filename='images/earn.png') }}" alt="Earn"> Earn
        </button>
        <button onclick="window.location.href='{{ url_for('upgrade') }}'">
            <img src="{{ url_for('static', filename='images/upgrade.png') }}" alt="Upgrade"> Upgrade
        </button>
    </footer>

    <script>
        // üìå Foydalanuvchini bot orqali aniqlash
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get("user_id"); // üõ† user_id to‚Äòg‚Äòri olinyapti

        if (!userId) {
            document.getElementById("warning").style.display = "block"; // ‚ùå Xato xabar chiqarish
        } else {
            fetch(`/api/get_user/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert("Foydalanuvchi topilmadi!");
                    } else {
                        document.getElementById("coins").innerText = data.coins || 0;
                        document.getElementById("energy").innerText = data.energy || 1000;
                    }
                })
                .catch(error => console.error("Xatolik:", error));
        }

        // üìå Tuxumni bosish funksiyasi (Tangani oshirish)
        function clickEgg() {
            if (!userId) {
                alert("Iltimos, bot orqali kiring!");
                return;
            }

            fetch(`/api/click_egg/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById("coins").innerText = data.coins;
                        document.getElementById("energy").innerText = data.energy;
                    } else {
                        alert("Energiyangiz yetarli emas!");
                    }
                })
                .catch(error => console.error("Xatolik:", error));
        }
    </script>
</body>
</html>